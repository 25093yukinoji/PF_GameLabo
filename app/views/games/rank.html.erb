<!--タブ名-->
<% @page_title = 'ランキング' %>
<h1 class='text-center font-weight-bold mb-3'>ランキング</h1>
  <% @ranking.each.with_index(1) do |game,i| %>
    <% i += @base_of_ranking %>
    <div class='row'>
      <div class='h3 align-self-center'><b>第<span class='ranknumber h2'><%= i %></span>位</b></div>
      <div class='col-md-4 pt-2'>
        <%= link_to game_path(game) do %>
          <%= attachment_image_tag game, :image, :fill, 220, 200, fallback: "img/noimage-1-580x440.png" %>
        <% end %>
      </div>
      <div class='col-3 align-self-center'>
        <h4 class='font-weight-bold'><%= game.title %></h4>
      </div>
      <div class='col-2 align-self-center'>
        <div id="rank-review-total_rate_<%= game.id %>" data-score=<%= game.total_rate %>></div>
      </div>
      <% if game.user == current_user %>
        <div class='col-1 align-self-center'>
          <%= link_to 'Edit', edit_game_path(game), class: "btn btn-success edit_game_#{game.id}" %>
        </div>
        <div class='col-1 align-self-center'>
          <%= link_to 'Destroy', game_path(game), method: :delete, data: { confirm: '本当に消しますか？' }, class: "btn btn-danger destroy_game_#{game.id}"%>
        </div>
      <% end %>
    </div>
  <% end %>
<script>
  <% @ranking.each do |game| %>
  $('#rank-review-total_rate_<%= game.id %>').raty({
    readOnly: true,
    starOn: "<%= asset_path('star-on.png') %>",
    starOff: "<%= asset_path('star-off.png') %>",
    starHalf: "<%= asset_path('star-half.png') %>",
    score: function() {
      return $(this).attr('data-score')
    }
  });
  <% end %>
</script>